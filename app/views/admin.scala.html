@import play.{Configuration => confi}
@import models.PaperResult
@import play.api.Configuration
@import play.api.libs.json.Json
@import controllers.routes
@import play.api.libs.json.JsObject
@import play.api.{Configuration, Logger}
@(configuration: Configuration, paperResultService: PaperResultService, answerService: AnswerService, conferenceSettingsService: ConferenceSettingsService,
        papersService: PapersService, conferences: List[models.Conference], papers: List[PapersWithStats])

@urlPrefix = {@confi.root().getString("url.prefix")}
@baseUrl = {@confi.root().getString("hcomp.ballot.baseURL")}

@mainFrame("Admin View") {
  <div class="row">
    <div class="col-sm-12 text-center">
        <div>
        <!--@for(conference <- conferences) {
            <option value="@conference.id">@conference.name</option>
        }-->
        </div>
        <div class="panel panel-default" onclick="loadConferencesResult()">
            <div class="panel-heading" role="tab" id="headingThree">
                @for(conference <- conferences){
                    <h1>
                    Conference : @conference.name
                    </h1>
                    <h2 id="papers">Papers</h2>
                    @if(papersService.findByConference(conference.id.getOrElse(0)).isEmpty) {
                        No paper has been uploaded and completely processed so far.
                    }
                    @for(paper <- PaperStats.getStats(papersService.findByConference(conference.id.getOrElse(0)), papersService, paperResultService,
                        answerService, conferenceSettingsService)) {
                        <div class="row paper">
                            <div class="col-md-2"></div>
                            <div class="col-md-10">
                                <div class="col-xs-1" style="width: 3%"></div>
                                <div class="col-xs-1 text-center">
                                        <!--<span class="glyphicon glyphicon-file"></span>-->
                                    <img class="pdf-icon" src="@{urlPrefix + routes.Assets.at("images/pdf-small.png").url}">
                                    <div class="paper-status">
                                    @paper.status match {
                                        case Papers.STATUS_COMPLETED => {
                                            <span class="glyphicon glyphicon-ok text-success"></span>
                                        }
                                        case Papers.STATUS_ERROR => {
                                            <span class="glyphicon glyphicon glyphicon-ban-circle text-danger"></span>
                                        }
                                        case _ => {
                                            <span class="glyphicon glyphicon-refresh text-muted"></span>
                                        }
                                    }
                                    </div>
                                </div>
                                <div class="col-xs-10">
                                    <div class="row">
                                        <div class="col-md-12 text-left">
                                            <b>@paper.name</b>
                                            <br>
                                            <a href="@{urlPrefix + routes.Paper.show(paper.id.get,paper.secret).url}">
                                                <span class="glyphicon glyphicon-share"></span>
                                                @{baseUrl.toString() + urlPrefix + routes.Paper.show(paper.id.get,paper.secret).url}
                                            </a><br>
                                            <div class="paper-stats">
                                                <span class="glyphicon glyphicon-ok text-success"></span>
                                                <div class="statItem">@paper.statsTotal.getOrElse(PaperResult.SYMBOL_OK,0)</div>
                                                <span class="glyphicon glyphicon-warning-sign text-warning"></span>
                                                <div class="statItem">@paper.statsTotal.getOrElse(PaperResult.SYMBOL_WARNING,0)</div>
                                                <span class="glyphicon glyphicon-ban-circle text-danger"></span>
                                                <div class="statItem">@paper.statsTotal.getOrElse(PaperResult.SYMBOL_WARNING,0)</div>
                                                <span class="glyphicon glyphicon-sunglasses"></span>
                                                <div onclick="confirmPaper(@paper)">Confirm&nbsp;Now</div>
                                                @if(paper.status == Papers.STATUS_AWAIT_CONFIRMATION){
                                                    <span class="glyphicon glyphicon-share"></span>
                                                    <div class="confirmItem">Not&nbsp;confirmed&nbsp;yet&nbsp;-&nbsp;
                                                        <span style="color:blue;font-weight:bold" onclick="confirmPaper(@paper)">
                                                                Confirm&nbsp;Now
                                                        </span>
                                                    </div>
                                                }
                                                @if(paper.status == Papers.STATUS_IN_PPLIB_QUEUE){
                                                    <span class="glyphicon glyphicon-check"></span>
                                                    <div class="confirmItem">Paper&nbsp;Confirmed</div>
                                                }
                                                @if(paper.status == Papers.STATUS_COMPLETED){
                                                    <span class="glyphicon glyphicon-ok-circle"></span>
                                                    <div class="confirmItem"> Analysis&nbsp;Completed </div>
                                                }
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                <div class="panel-body pb-padding-top">
                    <img id="sc-loader" src="@{urlPrefix + routes.Assets.at("images/loader2.gif").url}">
                </div>
            </div>
        </div>
        <div class="panel panel-default" onclick="loadSpellCheckerResults()">
            <div class="panel-heading" role="tab" id="headingThree">
                <h4 class="panel-title">
                    <a class="collapsed" role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                        All Papers
                    </a>
                </h4>
            </div>
            <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
                <div class="panel-body pb-padding-top">
                    <img id="sc-loader" src="@{urlPrefix + routes.Assets.at("images/loader2.gif").url}">
                </div>
            </div>
        </div>
    </div>
  </div>
  <script>
      function loadConferencesResult() {
          var conference = conferenceService.findByIdAndSecret(conferenceId, secret)
          if (conference.isEmpty) {
              Unauthorized(views.html.error.unauthorized())
          } else {
              var papers = papersService.findByConference(conferenceId)
              var papersWithStats = PaperStats.getStats(papers, papersService, paperResultService,
                      answerService, conferenceSettingsService)
              var stats = calculateConferenceStats(conferenceId, papersWithStats)
              Ok(views.html.conference.conferenceEditor(conferenceId, secret, conference.get.name, stats, papersWithStats))
          }
      }

      function confirmPaper(paper) {
          var paperLink = configuration.getString("hcomp.ballot.baseURL").get + routes.Paper.confirmPaper(paper.id.get, paper.secret).url;
          Logger.info("PAPERLINK: " + paperLink);
          window.open(paperLink);
      }

      function selectFile() {
        $("#fileSelect").get(0).click();
      }

      function submitForm() {
        showUploadProgress("upload");
        var data = new FormData();
        var fileData = $('input[name="paper"]')[0].files[0];
        var email = $('#emailIn').val()
        var conference = $('#conference').val()
        data.append("paper", fileData);
        data.append("conference", conference);
        data.append("email", email);
        $.ajax({
          url: '@{urlPrefix + routes.Upload.uploaded.url}',
          type: 'POST',
          data: data,
          cache: false,
          contentType: false,
          processData: false,
          success: function(data){
            console.log(data);
            if(data == "Ok") {
              showUploadProgress("success");
            } else {
              alert("Error, sorry! " + data);
              showUploadProgress("start");
            }
          }
        });
        return false;
      }

      function showUploadProgress(progress) {
        $("#upload-start").css({"display":"none"});
        $("#upload-upload").css({"display":"none"});
        $("#upload-success").css({"display":"none"});
        $("#upload-"+progress).css({"display":"inline-block"});
      }
  </script>
  <style>
          .file_button_container,
          .file_button_container #fileSelect {
            height: 135px;
            width: 130px;
            cursor:pointer ;
          }
          .statItem {
              display:inline-block ;
              width: 30px ;
              padding-right:5px ;
          }
          .confirmItem {
              display:inline-block ;
              width: 100px ;
              padding-right:5px ;
          }

          .file_button_container {
            display:inline-block;
            margin-top : 50px;
            background: transparent url('@{urlPrefix + routes.Assets.at("images/pdf.png").url}') left top no-repeat;
          }

          .file_button_container #fileSelect {
            opacity: 0;
          }

          #upload-upload, #upload-success {
            display:none;
          }

          #upload-upload img {
            width: 35px;
          }

          .data-input {
            display:inline-block;
            width: 100%;
            max-width: 300px;
            margin:20px;
          }

          .data-input select {
            margin-top: 5px
          }
  </style>
}
